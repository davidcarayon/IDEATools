---
title: "RAPPORT DE DIAGNOSTIC DE GROUPE IDEA 4"
output: 
  pdf_document:
    latex_engine: xelatex
    includes: 
      before_body: templates/page_de_garde_group.tex
      in_header: templates/preamble.tex
sansfont: Arial
mainfont: Arial
toc: true
params:
  data: "data"
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, out.width = "100%")

library(IDEATools)
IDEAdata <- params$data
metadata <- IDEAdata$data$metadata
n_farm <- nrow(metadata)
```

```{r}
nom_files <- metadata$MTD_01
date <- metadata$MTD_13
```

---
author: "`r paste(nom_files, collapse = ", ")`"
subtitle: `r paste0("Analyse du"," ",format(Sys.Date(),'%d/%m/%Y'))`
date : "`r paste(date, collapse = ", ")`"
---

\newpage

# Lecture par les dimensions de la durabilité

## Résultats pour les 3 dimensions 

```{r fig.cap = "Distribution des notes obtenues pour chaque dimension de la durabilité sur une échelle de 0 à 100", fig.width = 7.95, fig.height=6.91}
print(IDEAdata$dimensions_boxplot)
```

\newpage

```{r fig.cap = "Notes obtenues par chaque exploitation agricole pour chaque dimension de la durabilité",fig.width = 10.5, fig.height=8}
print(IDEAdata$dimensions_histogram)
```

\newpage

## Résultats pour les 13 composantes

```{r fig.cap= "Distribution des notes de durabilité obtenues pour chaque composante", fig.width = 13, fig.height=13}
print(IDEAdata$components_boxplot + ggplot2::theme(axis.text = ggplot2::element_text(size = 20)))
```

\newpage

## Résultats détaillés par indicateur

```{r fig.cap= "Distribution des notes obtenues pour les indicateurs agroécologiques, regroupés par composante", fig.width = 11.9, fig.height=11.8}
print(IDEAdata$indic_ae_boxplot)
```

```{r fig.cap= "Distribution des scores obtenus pour les indicateurs tocio-territoriaux, regroupés par composante", fig.width = 11.9, fig.height=14}
print(IDEAdata$indic_st_boxplot)
```

```{r fig.cap= "Distribution des scores obtenus pour les indicateurs économiques, regroupés par composante", fig.width = 11.9, fig.height=12}
print(IDEAdata$indic_ec_boxplot+ ggplot2::theme(axis.text = ggplot2::element_text(size = 13))) 
```

\newpage

# Lecture par les propriétés des systèmes agricoles durables

## Matrice des résultats individuels

```{r fig.cap= "Matrice des résultats par les propriétés du groupe", fig.width = 10.4, fig.height=6.82}
print(IDEAdata$heatmap)
```

\newpage

## Fréquence d'attribution de chaque modalité

\begin{center}
\rotatebox{270}{

\begin{minipage}{0.9\textheight}

```{r freq, fig.width = 33, fig.height = 20, out.width='100%', echo = FALSE}
ggplot2::ggplot(IDEAdata$freq_plot$data,ggplot2::aes(x = node_name, y = prop, fill = result)) +
      ggplot2::geom_col(position = "stack", color ="black") +
      ggplot2::geom_label(ggplot2::aes(label = paste0(round(prop),"%")),position = ggplot2::position_stack(vjust = 0.5),size = 17) +
      ggplot2::scale_fill_identity("\uc9valuation", guide = ggplot2::guide_legend(reverse = TRUE), labels = c("Très défavorable","Défavorable","Favorable","Très favorable")) +
      theme_idea() +
      ggplot2::coord_flip() +
      ggplot2::theme(axis.text = ggplot2::element_text(size = 45),axis.title = ggplot2::element_text(size = 45), legend.text = ggplot2::element_text(size = 45), legend.title = ggplot2::element_text(size = 50)) +
      ggplot2::labs(x = "", y = "Fr\u00e9quence (%)") +
      ggplot2::scale_y_continuous(breaks = seq(0,100,5))
```

\end{minipage}}
\end{center}

