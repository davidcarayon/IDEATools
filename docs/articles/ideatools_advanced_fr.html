<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Historique de développement • IDEATools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Historique de développement">
<meta property="og:description" content="IDEATools">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IDEATools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Fonctions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ideatools_advanced_fr.html">Présentation d'IDEATools</a>
    </li>
    <li>
      <a href="../articles/decision_rules.html">About decision rules</a>
    </li>
    <li>
      <a href="../articles/colored_trees.html">About colored trees</a>
    </li>
    <li>
      <a href="../articles/utils.html">Utility functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/davidcarayon/IDEATools" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://methode-idea.org/" class="external-link">
    <span class="fa fa-info"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Historique de développement</h1>
            
      
      
      <div class="hidden name"><code>ideatools_advanced_fr.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>IDEATools est un package R dédié à la méthode IDEA4, visant à fournir
aux utilisateurs des outils pour le traitement, l’automatisation et le
reporting de diagnostics IDEA4.</p>
<p>IDEATools 1.0 puis 1.1 ont été développés au cours de l’année 2020
pour répondre à des besoins (urgents) de sorties graphiques pour la
méthode IDEA4, notamment en ce qui concerne l’approche par les
propriétés. Cette première version du package était donc fonctionnelle
mais largement perfectible et n’était pas assez documentée. Dans une
optique de recherche reproductible et afin d’être mieux préparé aux
adaptations / évolutions de la méthode, IDEATools a subi d’assez lourdes
modifications pour aujourd’hui être proposé dans sa version 2.0.</p>
<p>IDEATools 2.0 propose un processus automatisé de diagnostic composé
de différents modules (<code><a href="../reference/read_idea.html">read_idea()</a></code>,
<code><a href="../reference/compute_idea.html">compute_idea()</a></code>, <code><a href="../reference/old_idea.html">old_idea()</a></code>,
<code><a href="../reference/plot_idea.html">plot_idea()</a></code>, <code><a href="../reference/write_idea.html">write_idea()</a></code>) tous regroupés dans
une fonction globale, <code><a href="../reference/diag_idea.html">diag_idea()</a></code>. La présente vignette
présente le fonctionnement général de chacun de ces modules et la
logique générale développée dans IDEATools.</p>
<p>IDEATools 3.0 a apporté une refonte complète du système de production
des arbres éclairés et la correction de nombreux bugs.</p>
</div>
<div class="section level2">
<h2 id="ideatools-3-0">IDEATools 3.0<a class="anchor" aria-label="anchor" href="#ideatools-3-0"></a>
</h2>
<p>La 3e version majeure d’IDEATools n’apporte pas de différence
significative sur le processus global de traitement développé pour la
version 2, excepté la correction de quelques bugs et la compatibilité
avec les dernières versions du calculateur.</p>
<p>Cette version apporte principalement une évolution au niveau du
traitement de la production des arbres éclairés. En effet, ces arbres ne
sont plus basés sur de la coloration de template “blanc” par des
algorithmes de rechercher-remplacer conditionnels, mais sur une syntaxe
ggplot s’appuyant sur des tables de références donnant les coordonées de
chaque ligne / noeud. Ce changement d’approche permet une meilleure
résilience aux changements de noms de noeuds et ouvre même la
possibilité d’une traduction automatique des arbres.</p>
<p>La palette de couleurs utilisée a également été revue pour accentuer
les contrastes et améliorer la lisibilité pour des utilisateurs avec
problèmes de distinction des couleurs :</p>
<p><img src="ideatools_advanced_fr_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="ideatools-2-0">IDEATools 2.0<a class="anchor" aria-label="anchor" href="#ideatools-2-0"></a>
</h2>
<div class="section level3">
<h3 id="pré-requis">Pré-requis<a class="anchor" aria-label="anchor" href="#pr%C3%A9-requis"></a>
</h3>
<p>Le package R {IDEATools} nécessite en premier lieu l’installation de
<a href="https://cran.r-project.org/" class="external-link">R</a> puis de <a href="https://rstudio.com/products/rstudio/download/" class="external-link">Rstudio</a>.</p>
<p>En attendant son acceptation sur les dépôts officiels du CRAN,
IDEATools nécessite l’installation d’un premier package, {remotes}, qui
lui permettra d’installer IDEATools depuis un dépôt “non officiel”
Github.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"davidcarayon/IDEATools"</span><span class="op">)</span></code></pre></div>
<div class="section level4">
<h4 id="dépendances-r">Dépendances R<a class="anchor" aria-label="anchor" href="#d%C3%A9pendances-r"></a>
</h4>
<p>Le code source d’IDEATools s’appuie sur une liste de 20 packages R
(aussi appelées dépendances). Ces packages (ainsi que leurs propres
dépendances) sont automatiquement installés en même temps qu’IDEATools
:</p>
<ul>
<li><p>{tidyr} permet le nettoyage de données</p></li>
<li><p>{janitor} permet d’autres nettoyages, notamment les noms de
colonne</p></li>
<li><p>{dplyr} permet la manipulation des données</p></li>
<li><p>{tibble} propose des tableaux de données améliorés</p></li>
<li><p>{stringr} permet la manipulation de chaînes de
caractères</p></li>
<li><p>{glue} permet de combiner des chaînes de caractères et des
variables</p></li>
<li><p>{magrittr} met à disposition des outils améliorant la lisibilité
du code</p></li>
<li><p>{jsonlite} permet la manipulation (lecture/écriture) de fichiers
json</p></li>
<li><p>{readxl} permet la manipulation (lecture/écriture) de fichiers
xls ou xlsx</p></li>
<li><p>{purrr} permet d’appliquer des fonctions de manière
itérative</p></li>
<li><p>{ggplot2} permet la production de graphiques</p></li>
<li><p>{ggpubr} permet la production de tableaux pouvant être insérés
dans des graphiques</p></li>
<li><p>{ggrepel} permet notamment l’affichage d’étiquettes avec décalage
automatique sur des graphiques</p></li>
<li><p>{ggimage} permet d’insérer des images dans des
graphiques</p></li>
<li><p>{pdftools} permet d’insérer des fichiers pdf dans des
graphiques</p></li>
<li><p>{cli} permet un affichage console esthétique</p></li>
<li><p>{rmarkdown} est un moteur permettant la production de rapports
automatiques</p></li>
<li><p>{knitr} permet de transformer tableaux et graphiques en éléments
pouvant être insérés dans des rapports automatiques</p></li>
<li><p>{ggtext} permet la production de cases avec textes pour les
arbres éclairés (geom_textbox)</p></li>
</ul>
<p>Enfin, 2 packages ne sont pas automatiquement installés (ceci afin de
réduire la liste des dépendances) mais restent nécessaires pour la
production de certains rapports automatiques :</p>
<ul>
<li><p>{officedown} pour les rapports docx</p></li>
<li><p>{openxlsx} pour les rapports xlsx</p></li>
</ul>
<p>Il suffit de les installer à l’aide de :</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"officedown"</span>,<span class="st">"openxlsx"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="autres-dépendances">Autres dépendances<a class="anchor" aria-label="anchor" href="#autres-d%C3%A9pendances"></a>
</h4>
<p>Pour la production de rapport PDF, une installation de LaTeX est
requise. Si vous n’avez jamais utilisé LaTeX, vous pouvez utiliser la
fonction <code><a href="https://rdrr.io/pkg/tinytex/man/install_tinytex.html" class="external-link">tinytex::install_tinytex()</a></code> pour installer une
version minimale de LaTeX vous permettant d’éditer des rapports au
format PDF en utilisant le package IDEATools. Une fois installé, vous
n’avez plus besoin de vous soucier de LaTeX (opération à réaliser
seulement lors de la première utilisation).</p>
</div>
</div>
<div class="section level3">
<h3 id="read_idea">read_idea()<a class="anchor" aria-label="anchor" href="#read_idea"></a>
</h3>
<p>Il s’agit de la toute première fonction du processus, permettant
d’identifier la validité du fichier d’entrée et d’en extraire
métadonnées et items.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/read_idea.html">read_idea</a></span><span class="op">(</span><span class="st">"chemin_calculateur"</span><span class="op">)</span></code></pre></div>
<p>Après plusieurs itérations du développement de cette fonction, Il
s’avère trop difficile de retrouver les items de manière automatique
pour des versions &lt; 4.2.0. Si la version est trop ancienne,
l’algorithme renverra une erreur et suggèrera une autre fonction,
<code>old_idea</code>, qui récupère directement les indicateurs plutôt
que les items et remplace donc <code><a href="../reference/read_idea.html">read_idea()</a></code> +
<code><a href="../reference/compute_idea.html">compute_idea()</a></code>.</p>
<p>La fonction <code><a href="../reference/read_idea.html">read_idea()</a></code> n’est développée que pour un
input d’un fichier INDIVIDUEL. Pour du traitement multi-individuel et/ou
de groupe, la fonction globale <code><a href="../reference/diag_idea.html">diag_idea()</a></code> appliquera cette
fonction de manière itérative.</p>
<div class="section level4">
<h4 id="fonctionnement">Fonctionnement<a class="anchor" aria-label="anchor" href="#fonctionnement"></a>
</h4>
<div class="section level5">
<h5 id="lecture-du-fichier-dentrée-et-contrôle-de-version">Lecture du fichier d’entrée et contrôle de version<a class="anchor" aria-label="anchor" href="#lecture-du-fichier-dentr%C3%A9e-et-contr%C3%B4le-de-version"></a>
</h5>
<ul>
<li><p>Quelle extension ? Si il n’y en a pas (= dossier) alors
l’algorithme renvoie un message d’erreur</p></li>
<li><p>Est-ce que l’extension est XLS, XLSX ou JSON ? Sinon, renvoi d’un
message d’erreur.</p></li>
<li>
<p>Est-ce que ce sont des données IDEA ?</p>
<ul>
<li>Recherche de la présence d’un onglet ‘Notice’ pour les fichiers
excel</li>
<li>Recherche d’un champ “métadonnées” pour un json</li>
<li>Sinon, renvoi d’un message d’erreur</li>
</ul>
</li>
<li>
<p>Recherche du numéro de version, converti en chiffre (ex : 420
pour 4.2.0)</p>
<ul>
<li>Champs MTD_00 si json</li>
<li>Cellule Notice$K4 si excel</li>
<li>Si le numéro est introuvable alors une erreur dit que le fichier
d’entrée est trop ancien et suggère une fonction alternative
(<code><a href="../reference/old_idea.html">old_idea()</a></code>). Attention cependant, les calculateurs
antérieurs au 01/01/2019 ne fonctionneront probablement pas.</li>
</ul>
</li>
</ul>
</div>
<div class="section level5">
<h5 id="trouver-les-métadonnées">Trouver les métadonnées<a class="anchor" aria-label="anchor" href="#trouver-les-m%C3%A9tadonn%C3%A9es"></a>
</h5>
<p>Dans le cas d’un fichier json, les métadonnées sont facile à trouver
car stockées dans le champs “$metadonnees”.</p>
<p>Si la version est supérieure ou égale à la 4.2.5, alors on va diviser
la valeur de MTD_15 par 100. En effet, à partir de cette version, MTD_15
n’est plus une proportion (0-1) mais un pourcentage. Afin de ne pas
rencontrer de soucis dans les algorithmes suivants, cette valeur est à
nouveau convertie en proportion pour être compatible avec les anciennes
versions.</p>
<p>Si on ne trouve pas de MTD_01 (NA ou 0), alors on utilise <strong>le
nom du fichier (limité à 10 signes), sans extension.</strong></p>
<p>On décide également de standardiser MTD_14 pour qu’il devienne un
numérique 0, 1 ou 2, quelle que soit l’écriture dans le json (que ce
soit “2 - herbivore” ou “herbivore”, cela renverra “2”). En effet, des
tests seront effectués sur cette valeur pour le calcul
d’indicateurs.</p>
<p>Enfin, les métadonnées sont converties au bon format, soit numérique
soit texte (Note : Les métadonnées numériques discrètes (ex : 0, 1, 2,
3) sont converties en texte pour éviter toute possible erreur) selon le
tableau suivant :</p>
<center>
<table class="table">
<thead><tr class="header">
<th>Métadonnée</th>
<th>Description</th>
<th>Type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>MTD_00</td>
<td>Version du calculateur utilisée</td>
<td>Texte</td>
</tr>
<tr class="even">
<td>MTD_01</td>
<td>Identifiant exploitation</td>
<td>Texte</td>
</tr>
<tr class="odd">
<td>MTD_02</td>
<td>SAU</td>
<td>Numérique</td>
</tr>
<tr class="even">
<td>MTD_03</td>
<td>UTH</td>
<td>Numérique</td>
</tr>
<tr class="odd">
<td>MTD_04</td>
<td>UTH F</td>
<td>Numérique</td>
</tr>
<tr class="even">
<td>MTD_05</td>
<td>Tranche d’âge du chef d’exploitation</td>
<td>Texte</td>
</tr>
<tr class="odd">
<td>MTD_06</td>
<td>Typologie d’exploitation (OTEX)</td>
<td>Texte</td>
</tr>
<tr class="even">
<td>MTD_07</td>
<td>Surface en herbe en % de la SAU</td>
<td>Numérique</td>
</tr>
<tr class="odd">
<td>MTD_08</td>
<td>Capital d’exploitation</td>
<td>Numérique</td>
</tr>
<tr class="even">
<td>MTD_09</td>
<td>EBE</td>
<td>Numérique</td>
</tr>
<tr class="odd">
<td>MTD_10</td>
<td>Résultat courant</td>
<td>Numérique</td>
</tr>
<tr class="even">
<td>MTD_11</td>
<td>Zone géographique (département)</td>
<td>Texte</td>
</tr>
<tr class="odd">
<td>MTD_12</td>
<td>Atelier hors sol: oui / non</td>
<td>Texte</td>
</tr>
<tr class="even">
<td>MTD_13</td>
<td>Année d’enquête</td>
<td>Texte</td>
</tr>
<tr class="odd">
<td>MTD_14</td>
<td>Type d’élevage</td>
<td>Texte</td>
</tr>
<tr class="even">
<td>MTD_15</td>
<td>Part des PP dans la SAU</td>
<td>Numérique</td>
</tr>
<tr class="odd">
<td>MTD_16</td>
<td>Usage des produits phytos: oui /non</td>
<td>Texte</td>
</tr>
<tr class="even">
<td>MTD_17</td>
<td>Lycée agricole: oui /non</td>
<td>Texte</td>
</tr>
</tbody>
</table>
</center>
<p>Enfin, si l’algorithme ne trouve pas très exactement 17 ou 18 valeurs
de métadonnées, il renverra un message d’erreur.</p>
<p>Dans le cas d’un fichier excel, on va chercher les métadonnées dans
la plage <strong>A4:E21</strong> de l’onglet “Renvoi BDD”. Si par un
souci technique MTD_00 n’a pas pu être récupéré dans ce tableau (0 par
exemple), on tente d’y insèrer ‘Notice$K4’. Ensuite, les mêmes contrôles
sont appliqués que pour le JSON (MTD_01, MTD_14, présence de 17
valeurs)</p>
<p>Dans les deux cas, à la fin, on regarde si il existe bien une valeur
pour MTD_14, MTD_15 et MTD_16 car ce sont des métadonnées cruciales pour
le calcul d’indicateurs. Si il manque une de ces valeurs, un message
d’erreur sera produit.</p>
</div>
<div class="section level5">
<h5 id="extraction-des-items">Extraction des items<a class="anchor" aria-label="anchor" href="#extraction-des-items"></a>
</h5>
<p>Dans le cas d’un input en json, les items sont facile à extraire dans
le champs “$item” du fichier. On rajoute ici juste une modification de
chaîne de caractère pour que, par exemple, “IDEA_A01_1” devienne “A1_1”.
Si l’algorithme ne retrouve pas très exactement 118 valeurs d’items,
alors il renverra un message d’erreur.</p>
<p>Dans le cas d’un fichier excel, on va rechercher les items dans la
plage <strong>A25:E143</strong> de l’onglet “Renvoi BDD”. Ici encore, on
convertit les chaînes de caractères pour que “IDEA_A01_1” devienne
“A1_1”.</p>
<p>Si l’algorithme ne retrouve pas très exactement 118 valeurs d’items,
alors il renverra à nouveau un message d’erreur.</p>
</div>
<div class="section level5">
<h5 id="sortie">Sortie<a class="anchor" aria-label="anchor" href="#sortie"></a>
</h5>
<p>Renvoi d’un objet contenant metadonnées et items, avec l’étiquette
(aussi appelée “classe” en R) ‘IDEA_items’ pour que la fonction
suivante, <code><a href="../reference/compute_idea.html">compute_idea()</a></code>, puisse l’identifier.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="compute_idea">compute_idea()<a class="anchor" aria-label="anchor" href="#compute_idea"></a>
</h3>
<p>C’est la seconde fonction du processus. On va partir des données
précédemment récoltées pour calculer les
indicateurs/composantes/dimensions/propriétés.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/compute_idea.html">compute_idea</a></span><span class="op">(</span><span class="va">IDEA_items</span><span class="op">)</span></code></pre></div>
<p>La fonction s’appuie principalement sur des <strong>règles de
décisions</strong> qui sont stockées dans une liste interne au package,
<code>decision_rules_total</code>, qui contient :</p>
<ul>
<li>Un onglet contenant les seuils pour chaque indicateur pour passer
des scores numériques déplafonnés vers des modalités qualitatives</li>
<li>Un onglet contenant les règles de décisions pour l’agrégation des
items en indicateurs (cet onglet est informel, car ces règles de
décisions sont en fait codées dans le corps de la fonction).</li>
<li>Les 46 noeuds de la carte heuristique, 1 noeud par onglet.</li>
</ul>
<p>Le fichier contenant les règles de décisions peut être consulté via
:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/show_decision_rules.html">show_decision_rules</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Qui va exporter un fichier excel contenant les règles de décision
dans le répertoire de travail (ou dans un répertoire spécifique
indiqué).</p>
<div class="section level4">
<h4 id="fonctionnement-1">Fonctionnement<a class="anchor" aria-label="anchor" href="#fonctionnement-1"></a>
</h4>
<div class="section level5">
<h5 id="contrôle-à-lentrée">Contrôle à l’entrée<a class="anchor" aria-label="anchor" href="#contr%C3%B4le-%C3%A0-lentr%C3%A9e"></a>
</h5>
<p>Seules les données d’entrées portant la classe “IDEA_items” sont
acceptés par cette fonction.</p>
</div>
<div class="section level5">
<h5 id="agrégation-par-les-dimensions">Agrégation par les dimensions<a class="anchor" aria-label="anchor" href="#agr%C3%A9gation-par-les-dimensions"></a>
</h5>
<p>Le calcul des indicateurs correspond dans la majorité des cas à la
somme des items les constituants. Cependant, certains indicateurs
présentent des exceptions :</p>
<center>
<table class="table">
<colgroup>
<col width="16%">
<col width="43%">
<col width="39%">
</colgroup>
<thead><tr class="header">
<th>Indicateur</th>
<th>Si… (Condition)</th>
<th>Alors… (Resultat)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A1</td>
<td>Item2 = 4</td>
<td>A1 = 4</td>
</tr>
<tr class="even">
<td></td>
<td>Item2 != 4</td>
<td>A1 = sum(items)</td>
</tr>
<tr class="odd">
<td>A5</td>
<td>MTD_15 &gt;= 0.75</td>
<td>A5 = 5</td>
</tr>
<tr class="even">
<td></td>
<td>MTD_15 &lt; 0.75</td>
<td>A5 = sum(items)</td>
</tr>
<tr class="odd">
<td>A7</td>
<td>MTD_14 = 0</td>
<td>A7 = 0;</td>
</tr>
<tr class="even">
<td></td>
<td>MTD_14 = 1,</td>
<td>A7 = Item2</td>
</tr>
<tr class="odd">
<td></td>
<td>MTD_14 = 2</td>
<td>A7 = 0.7xItem1 + 0.3xItem2</td>
</tr>
<tr class="even">
<td>A8</td>
<td>MTD_15 &gt;= 0.95</td>
<td>A8 = 8</td>
</tr>
<tr class="odd">
<td></td>
<td>MTD_15 &lt; 0.95</td>
<td>A8 = sum(items)</td>
</tr>
<tr class="even">
<td>A14</td>
<td>MTD_16 = 0</td>
<td>A14 = 4</td>
</tr>
<tr class="odd">
<td></td>
<td>MTD_14 = 0</td>
<td>A14 = Item1</td>
</tr>
<tr class="even">
<td></td>
<td>MTD_16 != 0 AND MTD_14 != 0</td>
<td>A7 = min(items)</td>
</tr>
<tr class="odd">
<td>A19</td>
<td>MTD_14 = 0</td>
<td>A19 = Item1</td>
</tr>
<tr class="even">
<td></td>
<td>MTD_14 != 0</td>
<td>A19 = min(items)</td>
</tr>
<tr class="odd">
<td>B2</td>
<td>MTD_14 = 0</td>
<td>B2 = Item2</td>
</tr>
<tr class="even">
<td></td>
<td>MTD_14 != 0</td>
<td>B2 = Item1</td>
</tr>
<tr class="odd">
<td>B23</td>
<td>MTD_14 = 0</td>
<td>B23 = Item2</td>
</tr>
<tr class="even">
<td></td>
<td>MTD_14 != 0</td>
<td>B23 = round(mean(items))</td>
</tr>
</tbody>
</table>
</center>
<p>Ces règles sont compilées dans une des vignettes du package :</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"decision_rules"</span>, package <span class="op">=</span> <span class="st">"IDEATools"</span><span class="op">)</span></code></pre></div>
<p>Trois fonctions internes sont ensuite utilisées pour :</p>
<ul>
<li><p>Plafonner les indicateurs : Si la valeur déplafonnée est
supérieure à la valeur max de l’indicateur, alors l’indicateur prend la
valeur max. On en profite également pour arrondir certains résultats
(Note : On ajoute une valeur infiniment petite à l’indicateur avant
l’arrondi, afin de forcer l’arrondi au chiffre supérieur pour une valeur
à 0.5). Si le score déplafonné est inférieur à 0, alors il est ramené à
0.</p></li>
<li><p>Plafonner les composantes : Même principe que pour les
indicateurs.</p></li>
<li><p>Passer des composantes aux dimensions : Une simple somme des
composantes.</p></li>
</ul>
</div>
<div class="section level5">
<h5 id="agrégation-par-les-propriétés">Agrégation par les propriétés<a class="anchor" aria-label="anchor" href="#agr%C3%A9gation-par-les-propri%C3%A9t%C3%A9s"></a>
</h5>
<p>Une fonction interne permet d’utiliser la table de catégorisation
issue des règles de décisions afin d’attribuer une modalité qualitative
à chaque indicateur à partir de son score déplafonné.</p>
<p>Ensuite, Si MTD_14 vaut 0 (donc pas d’élevage), la modalité attribuée
à A7 est automatiquement convertie à “NC”.</p>
<p>Enfin, un très long code va calculer le résultat pour chacun des 46
noeuds d’agrégation selon la numérotation suivante :</p>
<p><img src="img/heuristic_numbers.png" width="100%"></p>
<p>Ces calculs sont réalisés par des jointures filtrantes
(<code>inner_join()</code>) entre les résultats des indicateurs et les
tables de contingence. A chaque jointure, il ne reste donc plus qu’une
ligne qui correspond à l’évaluation de l’exploitation.</p>
<p>Enfin, on conserve les noeuds terminaux de chaque propriété ainsi
qu’une table globale contenant l’ensemble des 99 éléments de la carte
heuristique.</p>
</div>
<div class="section level5">
<h5 id="sortie-1">Sortie<a class="anchor" aria-label="anchor" href="#sortie-1"></a>
</h5>
<p>L’objet de sortie se voit attribué l’étiquette “IDEA_data” pour la
suite et contient :</p>
<ul>
<li>metadata : Les métadonnées de l’exploitation, inchangées par rapport
à la fonction précédente.</li>
<li>dataset : Un tableau contenant les scores plafonnés, déplafonnés,
qualitatifs (propriété) pour les indicateurs, composantes,
dimensions.</li>
<li>nodes : Une liste contenant les tables avec l’évaluation de chaque
indicateur/noeud de chacune des 5 propriétés ainsi que la table globale
des 99 éléments de la carte heuristique.</li>
</ul>
</div>
</div>
</div>
<div class="section level3">
<h3 id="old_idea">old_idea()<a class="anchor" aria-label="anchor" href="#old_idea"></a>
</h3>
<p>Cette fonction est une alternative aux deux fonctions précédentes
(<code><a href="../reference/read_idea.html">read_idea()</a></code>+<code><a href="../reference/compute_idea.html">compute_idea()</a></code>) pour les
calculateurs les plus anciens (&lt; 4.2.0). En effet, il s’avère trop
difficile de retrouver les items de manière automatique pour ces
anciennes versions. La fonction accepte donc le même format d’entrée que
<code><a href="../reference/read_idea.html">read_idea()</a></code> et renvoie directement une sortie similaire à
<code><a href="../reference/compute_idea.html">compute_idea()</a></code>. Le principal inconvénient étant de ne pas
récupérer de données liées aux items et de manquer certaines
métadonnées.</p>
<p>En revanche, même cette fonction a ses limites et aucune garantie des
résultats n’est proposée pour des calculateurs antérieurs au
01/01/2019.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/old_idea.html">old_idea</a></span><span class="op">(</span><span class="st">"chemin_ancien_calculateur"</span><span class="op">)</span></code></pre></div>
<p>Les différentes étapes de cette fonction sont en tout point
identiques aux fonctions précédentes, à l’exception d’une étape
intermédiaire qui est supprimée (agrégation des items vers les
indicateurs) et une recherche des valeurs d’indicateurs qui se fait dans
chaque onglet relatif à chaque dimension plutôt que dans un onglet
unique “Renvoi BDD” qui n’existait pas encore.</p>
<p>Note : Pour l’identifiant de l’exploitation (MTD_01), l’algorithme
récupèrera en priorité le NOM/Prénom de l’exploitant si il le trouve,
sinon il se basera ici encore sur le nom de fichier, sans extension,
limité à 10 signes.</p>
</div>
<div class="section level3">
<h3 id="plot_idea">plot_idea()<a class="anchor" aria-label="anchor" href="#plot_idea"></a>
</h3>
<p>Troisème fonction du processus, visant à générer :</p>
<ul>
<li><p>Des graphiques de trois types (dimensions, arbres éclairés,
radars) à partir des données générées par les modules
<code><a href="../reference/compute_idea.html">compute_idea()</a></code> ou <code><a href="../reference/old_idea.html">old_idea()</a></code></p></li>
<li><p>Des graphiques de groupes pour les dimensions / propriétés dans
le cas d’une analyse de groupe.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_idea.html">plot_idea</a></span><span class="op">(</span><span class="va">IDEA_data</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dimension"</span>,<span class="st">"trees"</span>,<span class="st">"radars"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="img/cap_graphs.png" alt="Exemple de figures produites par IDEATools" width="100%"><p class="caption">
Exemple de figures produites par IDEATools
</p>
</div>
<p>L’objet d’entrée peut être de deux classes différentes :
“<code>IDEA\_data</code>” ou “<code>IDEA\_group\_data</code>”. La
fonction renverra un message d’erreur si aucune de ces deux classes
n’est trouvée dans l’input.</p>
<p>Là ou la classe “<code>IDEA\_data</code>” est la classe classique
produite par la sortie de <code><a href="../reference/compute_idea.html">compute_idea()</a></code> ou
<code><a href="../reference/old_idea.html">old_idea()</a></code> , la classe “<code>IDEA\_group\_data</code>” ne
peut être générée que par la fonction <code><a href="../reference/diag_idea.html">diag_idea()</a></code> dans le
cadre d’une analyse de groupe, qui va appliquer
<code>read_idea() puis compute_idea()</code> ou <code><a href="../reference/old_idea.html">old_idea()</a></code>
sur chaque exploitation de manière itérative avant d’agrégrer les
résultats dans un objet de classe “<code>IDEA\_group\_data</code>”.</p>
<p>Dans le cas d’une analyse individuelle, l’utilisateur peut définir le
type de graphiques qu’il veut produire via l’argument
<code>choices</code>. <strong>Attention</strong>, l’ensemble des 3 types
de graphiques possibles sont nécessaires pour l’option d’export
‘rapport’ dans la fonction suivante, <code><a href="../reference/write_idea.html">write_idea()</a></code>.</p>
<p>Dans le cas d’une analyse de groupe, l’argument <code>choices</code>
sera ignoré.</p>
<div class="section level4">
<h4 id="cas-dune-analyse-individuelle">Cas d’une analyse individuelle<a class="anchor" aria-label="anchor" href="#cas-dune-analyse-individuelle"></a>
</h4>
<div class="section level5">
<h5 id="contrôle">Contrôle<a class="anchor" aria-label="anchor" href="#contr%C3%B4le"></a>
</h5>
<p>Si la classe d’entrée est “<code>IDEA_data</code>”, alors il s’agit
d’une analyse individuelle et les graphiques seront produits en fonction
de ce que l’utilisateur a défini dans <code>choices</code>.</p>
</div>
<div class="section level5">
<h5 id="dimensions">Dimensions<a class="anchor" aria-label="anchor" href="#dimensions"></a>
</h5>
<div class="section level6">
<h6 id="palette-graphique">Palette graphique<a class="anchor" aria-label="anchor" href="#palette-graphique"></a>
</h6>
<p>Les codes hexadécimaux retenus pour ces graphiques sont issus de la
charte graphique IDEA4 et sont les suivants :</p>
<p><img src="ideatools_advanced_fr_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level6">
<h6 id="tracé-des-graphiques">Tracé des graphiques<a class="anchor" aria-label="anchor" href="#trac%C3%A9-des-graphiques"></a>
</h6>
<p>Les graphiques de l’approche par les dimensions sont pour la plupart
des histogrammes générés via <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>. Rien de particulier
à signaler à part des manipulation de facteurs pour que les barres
soient bien ordonnées et une gestion de l’encodage de l’intitulé des
dimensions. Dans le cadre de la production de ces graphiques, un thème
ggplot2 dédié à la méthode a été créé : <code><a href="../reference/theme_idea.html">theme_idea()</a></code>.</p>
<p>Pour le cas du diagramme polarisé des composantes, un premier fichier
PDF contenant un radar des composantes est d’abord exporté dans un
fichier temporaire. Puis, un second graphique ggplot ‘donut’ est généré,
importe le radar PDF en son centre puis insère des pictogrammes stockés
dans le dossier d’installation du package.</p>
</div>
</div>
<div class="section level5">
<h5 id="arbres-éclairés">Arbres éclairés<a class="anchor" aria-label="anchor" href="#arbres-%C3%A9clair%C3%A9s"></a>
</h5>
<div class="section level6">
<h6 id="palette-graphique-1">Palette graphique<a class="anchor" aria-label="anchor" href="#palette-graphique-1"></a>
</h6>
<p>Les codes hexadécimaux retenus pour ces graphiques sont issus de la
charte graphique IDEA4 et sont les suivants, à partir de très
défavorable jusqu’à très favorable en passant par la couleur
“intermédiaire” :</p>
<p><img src="ideatools_advanced_fr_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level6">
<h6 id="tracé-des-arbres">Tracé des arbres<a class="anchor" aria-label="anchor" href="#trac%C3%A9-des-arbres"></a>
</h6>
<p>L’algorithme de production des arbres éclairés est issu d’un travail
de longue haleine impliquant le test de très nombreuses méthodes et
packages R. Au final, la solution retenue a été de dessiner les modèles
en “blanc” sur un logiciel de dessin vectoriel (Inkscape) au format svg.
Le SVG est un langage de balisage (similaire au XML ou HTML) sur lequel
il est assez facile d’appliquer des algorithmes de rechercher/remplacer.
En effet, une balise de rectangle (correspondant à un noeud de l’arbre
éclairé) s’écrit :</p>
<pre><code>&lt;rect
       style="fill:#ffffff;fill-opacity:1;stroke:#001800;stroke-width:0.1"
       id="rect2-16"
       width="17.833706"
       height="4.9643545"
       x="370.30774"
       y="143.9761"
       inkscape:label="#rect2-16" /&gt;</code></pre>
<p>Il suffit donc d’assigner chaque “id” à un indicateur, puis on peut
rechercher-remplacer l’argument “<code>fill:#ffffff</code>” par la
couleur adéquate correspondant à l’évaluation.</p>
<p>Les modèles sont compilés puis stockés sous forme d’un objet interne
R nommé “<code>canvas</code>”. Il s’agit d’une liste contenant le code
source SVG de chaque modèle. Ces modèles blancs sont exportables /
consultables via :</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">IDEATools</span><span class="fu">::</span><span class="fu">show_canvas</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>L’objet renvoyé par la fonction contient une liste similaire à
“<code>canvas</code>”, mais avec le blanc remplacé par les bonnes
couleurs. Les fonctions dans <code><a href="../reference/write_idea.html">write_idea()</a></code> sont ensuite
capables de convertir ce code SVG en image PNG et/ou PDF.</p>
<p><strong>Attention</strong> : Pour les futures modifications des
modèles, il est particulièrement important de ne pas modifier les “id”
de chaque rectangle, au risque de ne pas assigner le bon indicateur à
son rectangle.</p>
</div>
</div>
<div class="section level5">
<h5 id="radars">Radars<a class="anchor" aria-label="anchor" href="#radars"></a>
</h5>
<p>Ces graphiques sont produits avec <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> et sont une
version polarisée (<code>coord_polar()</code>) d’histogrammes des
indicateurs regroupés par propriétés. On rajoute également une
standardisation des scores d’indicateurs en les passant en pourcentage
(ceci afin que les indicateurs soient tous sur la même échelle).</p>
<p>En réalité, il ne s’agit pas de diagrammes radar mais d’histogrammes
transformés dans des coordonnées polaires. Nous utilisons cependant la
dénomination radar par facilité.</p>
<p>Puisque les intitulés d’indicateurs sont bien trop longs pour être
affichés sur le diagramme polarisé, un tableau associé au graphique est
à chaque fois produit, donnant la correspondance entre code indicateur
et intitulé de l’indicateur. Les lignes du tableau (ainsi que les
histogrammes) sont aussi colorés en fonction de la dimension
d’appartenance de l’indicateur. Enfin, les graphique et tableaux sont
regroupés pour produire une figure unique pour chaque propriété.</p>
</div>
</div>
<div class="section level4">
<h4 id="cas-dune-analyse-de-groupe">Cas d’une analyse de groupe<a class="anchor" aria-label="anchor" href="#cas-dune-analyse-de-groupe"></a>
</h4>
<p>C’est dans le corps de la fonction <code><a href="../reference/diag_idea.html">diag_idea()</a></code> que cette
étiquette de groupe est rajoutée, en fonction du type d’analyse demandé
par l’utilisateur.</p>
<div class="section level5">
<h5 id="contrôle-1">Contrôle<a class="anchor" aria-label="anchor" href="#contr%C3%B4le-1"></a>
</h5>
<p>Si la classe d’entrée est “<code>IDEA_group_data</code>”, alors il
s’agit d’une analyse de groupe. L’argument <code>choices</code> sera
donc ignoré.</p>
</div>
<div class="section level5">
<h5 id="graphiques-de-groupe">Graphiques de groupe<a class="anchor" aria-label="anchor" href="#graphiques-de-groupe"></a>
</h5>
<p>Pour les dimensions, les graphiques sont quasi-identiques aux
graphiques de l’analyse individuelle, à la nuance près que les
histogrammes sont remplacés par des boxplots. Nous rajoutons également
une forme d’histogrammes empilés pour comparer les exploitations entre
elles selon leurs trois dimensions.</p>
<p>Concernant les propriétés, la seule visualisation actuellement jugée
pertinente est une matrice (ou heatmap) de <strong>propriétés x
exploitations</strong>, avec les cases colorées selon l’évaluation
qualitative obtenue par l’exploitation pour une propriété donnée.</p>
</div>
</div>
<div class="section level4">
<h4 id="sortie-2">Sortie<a class="anchor" aria-label="anchor" href="#sortie-2"></a>
</h4>
<p>L’objet de sortie sera une liste de graphiques, avec une des deux
étiquettes <code>IDEA_plots</code> ou <code>IDEA_group_plots</code>
selon le type d’entrée, accompagné d’un item “data” contenant les
données originales insérées dans <code><a href="../reference/plot_idea.html">plot_idea()</a></code> qui sont
nécessaires pour la fonction <code><a href="../reference/write_idea.html">write_idea()</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="write_idea">write_idea()<a class="anchor" aria-label="anchor" href="#write_idea"></a>
</h3>
<p>Quatrième et dernière fonction du processus, elle vise a exporter les
résultats sous forme de graphiques bruts et/ou sous forme de rapports
avec une large variété de formats possibles.</p>
<p>Ici encore, l’objet d’entrée peut être de deux classes,
“<code>IDEA_plots</code>” ou “<code>IDEA_group_plots</code>”, selon si
nous sommes dans le cadre d’une analyse individuelle ou de groupe. Le
comportement de la fonction sera différent selon la classe d’entrée.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/write_idea.html">write_idea</a></span><span class="op">(</span><span class="va">IDEA_plots</span>,
           output_directory <span class="op">=</span> <span class="st">"IDEATools_output"</span>,
           type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"local"</span>, <span class="st">"report"</span><span class="op">)</span>,
           prefix <span class="op">=</span> <span class="st">"EA"</span>,
           dpi <span class="op">=</span> <span class="fl">300</span>,
           report_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pdf"</span>, <span class="st">"html"</span>, <span class="st">"docx"</span>, <span class="st">"odt"</span>, <span class="st">"pptx"</span>, <span class="st">"xlsx"</span><span class="op">)</span>,
           quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>L’utilisateur peut ici paramétrer :</p>
<ul>
<li>Le dossier de sortie des résultats</li>
<li>Le type de sorties (rapport et/ou graphiques bruts)</li>
<li>Le préfixe à rajouter aux fichiers de sortie (ex : le nom de la
ferme) dans le cas d’une analyse individuelle. S’il n’est pas précisé,
il prendra la valeur “metadata$MTD_01”.</li>
<li>Le format de sortie du rapport si désiré (au choix : pdf, docx, odt,
pptx, xlsx et html)</li>
<li>La résolution de sortie des graphiques (impacte notamment le poids
des sorties)</li>
<li>Si l’algorithme doit afficher sa progression dans la console.</li>
</ul>
<div class="section level4">
<h4 id="cas-dune-analyse-individuelle-1">Cas d’une analyse individuelle<a class="anchor" aria-label="anchor" href="#cas-dune-analyse-individuelle-1"></a>
</h4>
<div class="section level5">
<h5 id="contrôle-2">Contrôle<a class="anchor" aria-label="anchor" href="#contr%C3%B4le-2"></a>
</h5>
<p>Si l’objet d’entrée est de classe “<code>IDEA_plots</code>”, alors le
premier processus de traitement est enclenché, correspondant aux
analyses individuelles.</p>
</div>
</div>
<div class="section level4">
<h4 id="sortie-locale">Sortie “locale”<a class="anchor" aria-label="anchor" href="#sortie-locale"></a>
</h4>
<p>Si l’utilisateur choisit une sortie “locale”, alors différents
algorithmes vont être produits en fonction de ce que l’utilisateur avait
indiqué dans <code><a href="../reference/plot_idea.html">plot_idea()</a></code> concernant le choix des graphiques
à produire.</p>
<p>Dans le répertoire défini par l’utilisateur, un sous-dossier nommé
selon la date du système sera d’abord créé. Ainsi, l’utilisateur pourra
conserver ce dossier de sortie pour toutes ses sorties IDEATools s’il le
souhaite.</p>
<p>Les graphiques seront ensuite exportés dans un sous-dossier nommé
selon l’argument “<code>prefix</code>” de la fonction, ceci afin de ne
pas mélanger les résultats de différents diagnostics.</p>
<p>L’architecture de ce dernier sous-dossier sera du type :</p>
<ul>
<li><p>Dimensions</p></li>
<li>
<p>Propriétés</p>
<ul>
<li><p>Arbres éclairés</p></li>
<li><p>Radars</p></li>
</ul>
</li>
</ul>
<p>Chaque fichier sera également préfixé avec <code>prefix</code>.</p>
</div>
<div class="section level4">
<h4 id="sortie-rapport">Sortie “rapport”<a class="anchor" aria-label="anchor" href="#sortie-rapport"></a>
</h4>
<p>L’utilisateur peut ici choisir un <strong>ou plusieurs</strong>
formats de sortie parmis pdf, docx, odt, pptx, xlsx, html.</p>
<ul>
<li><p>Si le format est pdf, docx, odt, pptx, les packages utilisés sont
{rmarkdown}, {officer} et {officedown} et s’appuient sur des modèles
stockés dans les fichiers internes du package.</p></li>
<li><p>Si le format est html ou pdf, alors c’est {pagedown} qui est
utilisé pour produire des rapports HTML paginés. Les feuilles de style
(css) sont stockées dans les fichiers internes du package. Le fichier
peut ensuite être converti en PDF via une impression utilisant le moteur
de google chrome.</p></li>
<li><p>Si le format est xlsx, alors c’est {openxlsx} qui est utilisé
pour produire les documents excel. La structure du document est
construite par une fonction interne d’IDEATools non exportée,
<code>excel_report()</code>.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="cas-dune-analyse-de-groupe-1">Cas d’une analyse de groupe<a class="anchor" aria-label="anchor" href="#cas-dune-analyse-de-groupe-1"></a>
</h4>
<p>C’est dans le corps de la fonction <code><a href="../reference/diag_idea.html">diag_idea()</a></code> que cette
étiquette de groupe est rajoutée, en fonction du type d’analyse demandé
par l’utilisateur.</p>
<div class="section level5">
<h5 id="contrôle-3">Contrôle<a class="anchor" aria-label="anchor" href="#contr%C3%B4le-3"></a>
</h5>
<p>Si l’objet d’entrée est de classe “<code>IDEA_group_plots</code>”,
alors le second processus de traitement est enclenché, correspondant aux
analyses de groupe. L’argument <code>prefix</code> est ignoré : les
préfixes seront ici générés à partir du MTD_01.</p>
</div>
</div>
<div class="section level4">
<h4 id="sorties">Sorties<a class="anchor" aria-label="anchor" href="#sorties"></a>
</h4>
<p>Les mécanismes de sorties seront ici les même que dans le cas d’une
analyse individuelle, mais avec production de graphiques différents
(Boxplots, Heatmap, etc.) et de rapports à la trame différente. Le
dossier de sortie contiendra un sous-dossier nommé d’après la date du
système, puis un sous dossier au format “Groupe_{nombre
d’exploitations}”.</p>
</div>
</div>
<div class="section level3">
<h3 id="diag_idea">diag_idea()<a class="anchor" aria-label="anchor" href="#diag_idea"></a>
</h3>
<p>Chacun des modules développé dans IDEATools est indépendant et
fonctionnel, pouvant être utilisé dans des cadres spécifiques.
L’objectif de <code><a href="../reference/diag_idea.html">diag_idea()</a></code> est d’assembler ces modules dans
une fonction unique et facile d’utilisation.</p>
<p>L’utilisateur peut y insérer un fichier, une liste de fichiers ou un
répertoire de calculateurs excel ou fichiers json, puis spécifier son
répertoire de sortie, le type d’analyse (individuel, multi-individuel,
groupe), le type d’export (fichiers locaux en PNG, rapport) et
paramétrer ces exports en termes de formats attendus.</p>
<p>Les options sont cummulables. Si plusieurs formats de rapport sont
par exemple précisés, tous les formats demandés seront produits. Il en
va de même si l’analyse multi-individuelle et de groupe sont souhaitées
en même temps. En revanche, il est impossible de demander une analyse de
groupe sur un échantillon inférieur à 3 exploitations.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/diag_idea.html">diag_idea</a></span><span class="op">(</span><span class="va">input</span>,
          <span class="va">output_directory</span>,
          type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"single"</span>,<span class="st">"group"</span><span class="op">)</span>,
          export_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"report"</span>,<span class="st">"local"</span>,<span class="cn">NULL</span><span class="op">)</span>,
          plot_choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dimensions"</span>,<span class="st">"trees"</span>,<span class="st">"radars"</span><span class="op">)</span>,
          report_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pdf"</span>,<span class="st">"html"</span>,<span class="st">"docx"</span>,<span class="st">"odt"</span>,<span class="st">"pptx"</span>,<span class="st">"xlsx"</span><span class="op">)</span>,
          prefix <span class="op">=</span> <span class="st">"EA"</span>,
          dpi <span class="op">=</span> <span class="fl">300</span>,
          quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Selon le type d’analyse inséré, différentes procédures interne sont
suivies.</p>
<div class="section level4">
<h4 id="analyses-individuelles">Analyses individuelles<a class="anchor" aria-label="anchor" href="#analyses-individuelles"></a>
</h4>
<p>Si l’input est un fichier unique, alors un simple processus
individuel sera utilisé :</p>
<p><img src="img/pipeline_individuel.png" width="100%"></p>
<p>Si l’<code>export_type</code> est <code>"report"</code> et/ou
<code>local</code> , les résultats sont exportés dans
<code>output_directory</code> , au sein d’un sous-répertoire nommé selon
la date système (ainsi, l’utilisateur pourra conserver ce dossier de
sortie pour toutes ses sorties IDEATools s’il le souhaite) puis dans un
sous-repertoire nommé selon <code>prefix</code> .</p>
<p>Si export_type est <code>NULL</code>, alors la dernière étape
(<code><a href="../reference/write_idea.html">write_idea()</a></code>) sera omise et le résultat de
<code><a href="../reference/plot_idea.html">plot_idea()</a></code> sera renvoyé.</p>
</div>
<div class="section level4">
<h4 id="analyses-multi-individuelles">Analyses multi-individuelles<a class="anchor" aria-label="anchor" href="#analyses-multi-individuelles"></a>
</h4>
<p>Si l’input est une liste de fichiers et/ou un répertoire et que le
type est “<code>single</code>”, alors le processus d’analyse
individuelle sera répété itérativement sur chaque fichier d’entrée :</p>
<p><img src="img/pipeline_multi_individuel.png" width="100%"></p>
<p>Dans ce contexte d’analyse multi-individuelle, l’argument
<code>prefix</code> sera ignoré et les préfixes seront définis à partir
du champs <code>metadata$MTD_01</code> des données.</p>
<p>Si l’<code>export_type</code> est <code>"report"</code> et/ou
<code>local</code> , les résultats sont exportés dans
<code>output_directory</code> , au sein d’un sous-répertoire nommé selon
la date système, dans un sous répertoire au nom de chaque exploitation
(selon <code>metadata$MTD_01</code>).</p>
<p>Si export_type est <code>NULL</code>, alors la dernière étape
(<code><a href="../reference/write_idea.html">write_idea()</a></code>) sera à chaque fois omise et les multiples
sorties de <code><a href="../reference/plot_idea.html">plot_idea()</a></code> sont compilées dans une liste puis
renvoyés à l’utilisateur.</p>
</div>
<div class="section level4">
<h4 id="analyses-de-groupe">Analyses de groupe<a class="anchor" aria-label="anchor" href="#analyses-de-groupe"></a>
</h4>
<p>Si l’input est une liste de fichiers et/ou un répertoire, et que le
type est “<code>group</code>”, alors le processus d’import
(<code>read_idea() puis compute_idea()</code> ou
<code><a href="../reference/old_idea.html">old_idea()</a></code>) est répété itérativement sur chaque fichier
d’entrée puis les résultats sont compilés dans un objet de classe
“<code>IDEA_group_data</code>”.</p>
<p>Cet objet est ensuite inséré dans le processus
<code>plot_idea() puis write_idea()</code> qui adopteront un
comportement différent, adapté à l’analyse de groupe.</p>
<p><img src="img/pipeline_groupe.png" width="100%"></p>
<p>Ici encore, l’argument <code>prefix</code> sera ignoré et les
préfixes seront définis à partir du champs <code>metadata$MTD_01</code>
des données.</p>
<p>Si l’<code>export_type</code> est <code>"report"</code> et/ou
<code>local</code> , les résultats sont exportés dans
<code>output_directory</code> , au sein d’un sous-répertoire nommé selon
la date système, dans un sous répertoire supplémentaire au format
“Groupe_{nombre d’exploitations}”</p>
<p>Si export_type est <code>NULL</code>, alors la dernière étape
(<code><a href="../reference/write_idea.html">write_idea()</a></code>) sera omise et le résultat de
<code><a href="../reference/plot_idea.html">plot_idea()</a></code> sera renvoyé à l’utilisateur.</p>
<p>Note : Une erreur sera systématiquement renvoyée si le nombre
d’exploitations inséré (via un répertoire ou via un vecteur de chemins
d’accès) est strictement inférieur à 3.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Carayon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
